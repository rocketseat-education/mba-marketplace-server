'use strict';const a67_0x5df049=a67_0x17ae;function a67_0x17ae(_0x2d93d6,_0x5b9d11){const _0x138f00=a67_0x138f();return a67_0x17ae=function(_0x17ae19,_0x338bee){_0x17ae19=_0x17ae19-0x1cc;let _0x5828ba=_0x138f00[_0x17ae19];return _0x5828ba;},a67_0x17ae(_0x2d93d6,_0x5b9d11);}(function(_0x2c190b,_0x4d7559){const _0x56b220=a67_0x17ae,_0x5992d4=_0x2c190b();while(!![]){try{const _0x315a30=parseInt(_0x56b220(0x1da))/0x1+parseInt(_0x56b220(0x1d9))/0x2*(-parseInt(_0x56b220(0x1dc))/0x3)+parseInt(_0x56b220(0x1f4))/0x4+parseInt(_0x56b220(0x1e7))/0x5+-parseInt(_0x56b220(0x1ef))/0x6*(parseInt(_0x56b220(0x1dd))/0x7)+parseInt(_0x56b220(0x1e2))/0x8+parseInt(_0x56b220(0x1d4))/0x9;if(_0x315a30===_0x4d7559)break;else _0x5992d4['push'](_0x5992d4['shift']());}catch(_0x20d1cc){_0x5992d4['push'](_0x5992d4['shift']());}}}(a67_0x138f,0x2afad));var __decorate=this&&this[a67_0x5df049(0x1f9)]||function(_0x70796,_0x437ee4,_0x5693c1,_0x2e1f47){const _0x401fa9=a67_0x5df049;var _0x85fa9c=arguments['length'],_0x18a546=_0x85fa9c<0x3?_0x437ee4:_0x2e1f47===null?_0x2e1f47=Object[_0x401fa9(0x1ce)](_0x437ee4,_0x5693c1):_0x2e1f47,_0x3d9e62;if(typeof Reflect===_0x401fa9(0x1d1)&&typeof Reflect['decorate']==='function')_0x18a546=Reflect[_0x401fa9(0x1e3)](_0x70796,_0x437ee4,_0x5693c1,_0x2e1f47);else{for(var _0x520621=_0x70796[_0x401fa9(0x1db)]-0x1;_0x520621>=0x0;_0x520621--)if(_0x3d9e62=_0x70796[_0x520621])_0x18a546=(_0x85fa9c<0x3?_0x3d9e62(_0x18a546):_0x85fa9c>0x3?_0x3d9e62(_0x437ee4,_0x5693c1,_0x18a546):_0x3d9e62(_0x437ee4,_0x5693c1))||_0x18a546;}return _0x85fa9c>0x3&&_0x18a546&&Object[_0x401fa9(0x1ec)](_0x437ee4,_0x5693c1,_0x18a546),_0x18a546;},__metadata=this&&this[a67_0x5df049(0x1cd)]||function(_0x2a8704,_0x5d87fa){const _0x559990=a67_0x5df049;if(typeof Reflect===_0x559990(0x1d1)&&typeof Reflect[_0x559990(0x1eb)]==='function')return Reflect[_0x559990(0x1eb)](_0x2a8704,_0x5d87fa);},__importDefault=this&&this[a67_0x5df049(0x1d6)]||function(_0x9dd318){const _0x3f09d9=a67_0x5df049;return _0x9dd318&&_0x9dd318[_0x3f09d9(0x1f5)]?_0x9dd318:{'default':_0x9dd318};};Object[a67_0x5df049(0x1ec)](exports,a67_0x5df049(0x1f5),{'value':!![]}),exports[a67_0x5df049(0x1e1)]=void 0x0;const common_1=require('@nestjs/common'),dayjs_1=__importDefault(require(a67_0x5df049(0x1ea))),prisma_views_mapper_1=require('../mappers/prisma-views.mapper'),prisma_service_1=require(a67_0x5df049(0x1e9));function a67_0x138f(){const _0x3908ca=['9498pbnCza','PrismaViewsMapper','format','days','design:paramtypes','648316QkXYsv','__esModule','PrismaService','amount','toDate','__decorate','count','Injectable','__metadata','getOwnPropertyDescriptor','countPerDay','product','object','date','viewer','4083093zqbbjp','push','__importDefault','create','toCreate','542878YuVPol','74811kYHHJK','length','3UfQMNU','1183tJaeAM','add','getTime','sellerId','PrismaViewsRepository','85088doVhXV','decorate','from','view','default','69040eWUdHG','prisma','../prisma.service','dayjs','metadata','defineProperty','toString','DD/MM/YYYY'];a67_0x138f=function(){return _0x3908ca;};return a67_0x138f();}let PrismaViewsRepository=class PrismaViewsRepository{constructor(_0x4f6b36){const _0x10572b=a67_0x5df049;this[_0x10572b(0x1e8)]=_0x4f6b36;}async[a67_0x5df049(0x1cf)](_0x1ea44b){const _0x195b10=a67_0x5df049,_0x37fc22=await this[_0x195b10(0x1e8)]['$queryRaw']`
      SELECT
        strftime('%d/%m/%Y', DATETIME(ROUND(created_at / 1000), 'unixepoch')) as date,
        COUNT(*) as amount,
        created_at
      FROM "views"
      WHERE "product_id" IN (SELECT "id" FROM "products" WHERE "owner_id" = ${_0x1ea44b[_0x195b10(0x1e0)]})
      AND "created_at" >= ${_0x1ea44b[_0x195b10(0x1e4)][_0x195b10(0x1df)]()}
      GROUP BY date
      ORDER BY "created_at" ASC;
    `,_0x5e292a=[];for(let _0x32ff72=0x0;_0x32ff72<=(0x0,dayjs_1[_0x195b10(0x1e6)])()['diff'](_0x1ea44b['from'],_0x195b10(0x1f2));_0x32ff72++){const _0x54cda6=(0x0,dayjs_1[_0x195b10(0x1e6)])(_0x1ea44b[_0x195b10(0x1e4)])[_0x195b10(0x1de)](_0x32ff72,'days'),_0x40f383=_0x54cda6[_0x195b10(0x1f1)](_0x195b10(0x1ee)),_0x48254b=_0x37fc22['find'](_0x37e36e=>_0x37e36e[_0x195b10(0x1d2)]===_0x40f383);_0x5e292a[_0x195b10(0x1d5)]({'date':(0x0,dayjs_1['default'])(_0x54cda6)[_0x195b10(0x1f8)](),'amount':_0x48254b?Number(_0x48254b[_0x195b10(0x1f7)]):0x0});}return _0x5e292a;}async[a67_0x5df049(0x1fa)](_0x152947){const _0x364846=a67_0x5df049,_0x4a9410=await this[_0x364846(0x1e8)]['view'][_0x364846(0x1fa)]({'where':{'product':{'ownerId':_0x152947[_0x364846(0x1e0)]},'createdAt':{'gte':_0x152947[_0x364846(0x1e4)]}}});return _0x4a9410;}async['isViewed'](_0x335417){const _0x4b48f7=a67_0x5df049,_0x3c8dd5=await this[_0x4b48f7(0x1e8)][_0x4b48f7(0x1e5)]['findUnique']({'where':{'viewerId_productId':{'viewerId':_0x335417[_0x4b48f7(0x1d3)]['id'][_0x4b48f7(0x1ed)](),'productId':_0x335417[_0x4b48f7(0x1d0)]['id'][_0x4b48f7(0x1ed)]()}}});return!!_0x3c8dd5;}async[a67_0x5df049(0x1d7)](_0x228899){const _0x45636a=a67_0x5df049;return await this[_0x45636a(0x1e8)][_0x45636a(0x1e5)][_0x45636a(0x1d7)]({'data':prisma_views_mapper_1[_0x45636a(0x1f0)][_0x45636a(0x1d8)](_0x228899)}),_0x228899;}};exports[a67_0x5df049(0x1e1)]=PrismaViewsRepository,exports[a67_0x5df049(0x1e1)]=PrismaViewsRepository=__decorate([(0x0,common_1[a67_0x5df049(0x1cc)])(),__metadata(a67_0x5df049(0x1f3),[prisma_service_1[a67_0x5df049(0x1f6)]])],PrismaViewsRepository);