'use strict';const a67_0x5388ae=a67_0x1f53;(function(_0x318b40,_0x471ea2){const _0x332c05=a67_0x1f53,_0x43fa49=_0x318b40();while(!![]){try{const _0x19cc67=parseInt(_0x332c05(0xd4))/0x1*(-parseInt(_0x332c05(0xc6))/0x2)+-parseInt(_0x332c05(0xbe))/0x3+-parseInt(_0x332c05(0xc8))/0x4+parseInt(_0x332c05(0xce))/0x5+parseInt(_0x332c05(0xd9))/0x6*(parseInt(_0x332c05(0xd6))/0x7)+-parseInt(_0x332c05(0xc1))/0x8+-parseInt(_0x332c05(0xe1))/0x9*(-parseInt(_0x332c05(0xd3))/0xa);if(_0x19cc67===_0x471ea2)break;else _0x43fa49['push'](_0x43fa49['shift']());}catch(_0x88ebf8){_0x43fa49['push'](_0x43fa49['shift']());}}}(a67_0x9cbc,0xa9ccb));var __decorate=this&&this['__decorate']||function(_0x40db46,_0x111df6,_0x1dc81a,_0xb7aa26){const _0x429298=a67_0x1f53;var _0x4a7a47=arguments['length'],_0x3233f3=_0x4a7a47<0x3?_0x111df6:_0xb7aa26===null?_0xb7aa26=Object[_0x429298(0xda)](_0x111df6,_0x1dc81a):_0xb7aa26,_0x222463;if(typeof Reflect===_0x429298(0xbf)&&typeof Reflect[_0x429298(0xc7)]===_0x429298(0xe4))_0x3233f3=Reflect[_0x429298(0xc7)](_0x40db46,_0x111df6,_0x1dc81a,_0xb7aa26);else{for(var _0xab6621=_0x40db46['length']-0x1;_0xab6621>=0x0;_0xab6621--)if(_0x222463=_0x40db46[_0xab6621])_0x3233f3=(_0x4a7a47<0x3?_0x222463(_0x3233f3):_0x4a7a47>0x3?_0x222463(_0x111df6,_0x1dc81a,_0x3233f3):_0x222463(_0x111df6,_0x1dc81a))||_0x3233f3;}return _0x4a7a47>0x3&&_0x3233f3&&Object[_0x429298(0xe6)](_0x111df6,_0x1dc81a,_0x3233f3),_0x3233f3;},__metadata=this&&this[a67_0x5388ae(0xc0)]||function(_0x327893,_0x1da244){const _0x20f2e6=a67_0x5388ae;if(typeof Reflect===_0x20f2e6(0xbf)&&typeof Reflect[_0x20f2e6(0xc3)]==='function')return Reflect[_0x20f2e6(0xc3)](_0x327893,_0x1da244);},__importDefault=this&&this['__importDefault']||function(_0x3b2a26){return _0x3b2a26&&_0x3b2a26['__esModule']?_0x3b2a26:{'default':_0x3b2a26};};function a67_0x9cbc(){const _0x540f29=['@nestjs/common','DD/MM/YYYY','40kwdFhz','1531mwDdiO','default','5993645nVzxKc','date','sellerId','6sTOqnr','getOwnPropertyDescriptor','amount','getTime','Injectable','prisma','view','dayjs','6191109dNxlZU','toString','isViewed','function','create','defineProperty','viewer','PrismaViewsMapper','add','886323RePmGB','object','__metadata','10957472VXcmZT','format','metadata','count','find','1442IbtpHx','decorate','5247124nQKAbN','push','countPerDay','PrismaViewsRepository','days','../mappers/prisma-views.mapper','5842085phogQW','toDate','from'];a67_0x9cbc=function(){return _0x540f29;};return a67_0x9cbc();}function a67_0x1f53(_0x3e88d1,_0x2fa15c){const _0x9cbc44=a67_0x9cbc();return a67_0x1f53=function(_0x1f5389,_0x597941){_0x1f5389=_0x1f5389-0xbc;let _0x153e7a=_0x9cbc44[_0x1f5389];return _0x153e7a;},a67_0x1f53(_0x3e88d1,_0x2fa15c);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['PrismaViewsRepository']=void 0x0;const common_1=require(a67_0x5388ae(0xd1)),dayjs_1=__importDefault(require(a67_0x5388ae(0xe0))),prisma_views_mapper_1=require(a67_0x5388ae(0xcd)),prisma_service_1=require('../prisma.service');let PrismaViewsRepository=class PrismaViewsRepository{constructor(_0x38edf1){const _0x1d1ad6=a67_0x5388ae;this[_0x1d1ad6(0xde)]=_0x38edf1;}async[a67_0x5388ae(0xca)](_0x7d26f4){const _0x5d0489=a67_0x5388ae,_0x804eb5=await this['prisma']['$queryRaw']`
      SELECT
        strftime('%d/%m/%Y', DATETIME(ROUND(created_at / 1000), 'unixepoch')) as date,
        COUNT(*) as amount,
        created_at
      FROM "views"
      WHERE "product_id" IN (SELECT "id" FROM "products" WHERE "owner_id" = ${_0x7d26f4[_0x5d0489(0xd8)]})
      AND "created_at" >= ${_0x7d26f4['from'][_0x5d0489(0xdc)]()}
      GROUP BY date
      ORDER BY "created_at" ASC;
    `,_0x410992=[];for(let _0x5bed7a=0x0;_0x5bed7a<=(0x0,dayjs_1[_0x5d0489(0xd5)])()['diff'](_0x7d26f4[_0x5d0489(0xd0)],_0x5d0489(0xcc));_0x5bed7a++){const _0x4ec6a2=(0x0,dayjs_1[_0x5d0489(0xd5)])(_0x7d26f4['from'])[_0x5d0489(0xbd)](_0x5bed7a,_0x5d0489(0xcc)),_0x1716a3=_0x4ec6a2[_0x5d0489(0xc2)](_0x5d0489(0xd2)),_0x7089f3=_0x804eb5[_0x5d0489(0xc5)](_0x2d168a=>_0x2d168a[_0x5d0489(0xd7)]===_0x1716a3);_0x410992[_0x5d0489(0xc9)]({'date':(0x0,dayjs_1[_0x5d0489(0xd5)])(_0x4ec6a2)[_0x5d0489(0xcf)](),'amount':_0x7089f3?Number(_0x7089f3[_0x5d0489(0xdb)]):0x0});}return _0x410992;}async[a67_0x5388ae(0xc4)](_0x180ff9){const _0x3c68bb=a67_0x5388ae,_0x45737f=await this[_0x3c68bb(0xde)][_0x3c68bb(0xdf)]['count']({'where':{'product':{'ownerId':_0x180ff9[_0x3c68bb(0xd8)]},'createdAt':{'gte':_0x180ff9[_0x3c68bb(0xd0)]}}});return _0x45737f;}async[a67_0x5388ae(0xe3)](_0x17d2bb){const _0x28510d=a67_0x5388ae,_0x2613b1=await this[_0x28510d(0xde)][_0x28510d(0xdf)]['findUnique']({'where':{'viewerId_productId':{'viewerId':_0x17d2bb[_0x28510d(0xe7)]['id'][_0x28510d(0xe2)](),'productId':_0x17d2bb['product']['id'][_0x28510d(0xe2)]()}}});return!!_0x2613b1;}async[a67_0x5388ae(0xe5)](_0x18c6eb){const _0x20c296=a67_0x5388ae;return await this[_0x20c296(0xde)][_0x20c296(0xdf)]['create']({'data':prisma_views_mapper_1[_0x20c296(0xbc)]['toCreate'](_0x18c6eb)}),_0x18c6eb;}};exports[a67_0x5388ae(0xcb)]=PrismaViewsRepository,exports[a67_0x5388ae(0xcb)]=PrismaViewsRepository=__decorate([(0x0,common_1[a67_0x5388ae(0xdd)])(),__metadata('design:paramtypes',[prisma_service_1['PrismaService']])],PrismaViewsRepository);